<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>C00lGUI</title>
<style>
/* =========================================================================
   THEME + LAYOUT
   ------------------------------------------------------------------------- */
:root{
  --bg:#050405;
  --card-grad-top: rgba(255,255,255,0.02);
  --card-grad-bottom: rgba(255,255,255,0.01);
  --red:#ff3b3b;
  --accent:#ff6b6b;
  --red-deep:#b71c1c;
  --muted:rgba(255,255,255,0.92);
  --mono: "Courier New", Courier, monospace;
}
*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  background:
    radial-gradient(ellipse at center,#0f0f12 0%, #020202 60%),
    linear-gradient(180deg,#060003 0%, #000 100%);
  color:var(--muted);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

/* Wrapper for centered card */
.wrap {
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:28px;
}

/* Card */
.card {
  width:1060px;
  max-width:96%;
  background: linear-gradient(180deg, var(--card-grad-top), var(--card-grad-bottom));
  border-radius:12px;
  padding:28px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 30px 90px rgba(0,0,0,0.6);
  text-align:center;
}
.title{
  font-size:34px;
  color:var(--red);
  font-weight:900;
  margin-bottom:6px;
  text-shadow:0 0 18px rgba(255,80,80,0.12);
}
.sub{ color:rgba(255,255,255,0.78); margin-bottom:12px; }

/* Enable area */
.enable {
  display:inline-block;
  padding:12px 18px;
  border-radius:10px;
  background:transparent;
  border:1px solid rgba(255,255,255,0.03);
  cursor:default;
}
.kbd{
  background:rgba(255,255,255,0.03);
  padding:3px 8px;
  border-radius:6px;
  font-family:var(--mono);
  font-size:13px;
  color:var(--muted);
}

/* Terminal overlay (fake) */
#fakeCMD{
  display:none;
  position:fixed;
  top:6vh;
  left:6vw;
  width:88vw;
  height:88vh;
  max-width:1280px;
  max-height:920px;
  background:#070404;
  border:3px solid var(--red-deep);
  border-radius:10px;
  z-index:99999;
  overflow:hidden;
  color:var(--red);
  font-family:var(--mono);
  box-shadow:0 40px 160px rgba(183,28,28,0.35);
}
#cmdHeader{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 16px;
  background:linear-gradient(90deg, rgba(255,0,0,0.02), rgba(255,0,0,0.01));
  border-bottom:1px solid rgba(255,0,0,0.04);
}
#cmdTitle{font-weight:900;color:var(--red-deep)}
#cmdClose{margin-left:auto;background:transparent;border:none;color:var(--red);cursor:pointer;padding:8px 12px;border-radius:6px}
#cmdClose:hover{background:rgba(255,0,0,0.03)}
#cmdBody{
  padding:16px;
  height:calc(100% - 128px);
  overflow:auto;
  white-space:pre-wrap;
  font-size:14px;
  line-height:1.45;
  background: linear-gradient(180deg,#040303 0%, #000 100%);
}
#cmdInputWrap{
  padding:10px 16px 18px 16px;
  border-top:1px solid rgba(255,0,0,0.03);
  display:flex;
  gap:8px;
  align-items:center;
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
#cmdPrompt{color:var(--red);font-family:var(--mono);font-size:14px}
#cmdInput{
  flex:1;background:transparent;border:none;outline:none;color:var(--red);font-family:var(--mono);font-size:14px
}

/* Inline progress inside terminal */
.progressInlineOuter{
  width:80%;
  height:12px;
  background:rgba(255,255,255,0.02);
  border-radius:8px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,0.02);
  margin:8px 0;
}
.progressInlineInner{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent),var(--red));
  transition:width 80ms linear;
}

/* Visual SVG wrapper */
.visual-wrap{ margin:12px 0; display:flex; justify-content:center; align-items:center; }
.visual-wrap svg{ width:88%; max-width:920px; height:auto; display:block; background:#020202; border-radius:6px; border:1px solid rgba(255,255,255,0.02); }

/* Command line styles */
.cmd-line{ margin:6px 0; font-family:var(--mono); color:var(--red); }
.cmd-echo{ font-weight:600; color:var(--red); }
.cmd-strong{ font-weight:800; color:var(--red); }
.accessDenied{ display:block; margin-top:8px; font-weight:900; font-size:34px; color:#ff4d4d; text-shadow:0 0 18px rgba(255,0,0,0.18); letter-spacing:2px; }

/* Glitch alert styles (for the 30s one-time alert) */
.cmd-alert {
  font-weight:900;
  font-size:20px;
  color:#ff4d4d;
  text-shadow: 0 0 8px rgba(255,0,0,0.18);
  margin-top:8px;
  animation: glitchFlash 80ms steps(2,end) 0s 12; /* short rapid flashes for ~1s */
  display:inline-block;
  padding:6px 8px;
  border-radius:6px;
  background: rgba(255,0,0,0.02);
}
@keyframes glitchFlash {
  0% { opacity: 0.05; transform: translateX(0); }
  10% { opacity: 0.95; transform: translateX(-2px); }
  20% { opacity: 0.2; transform: translateX(1px); }
  30% { opacity: 0.95; transform: translateX(0); }
  40% { opacity: 0.1; transform: translateX(-1px); }
  50% { opacity: 0.95; transform: translateX(2px); }
  60% { opacity: 0.05; transform: translateX(0); }
  100% { opacity: 0.95; transform: translateX(0); }
}

/* Responsive */
@media (max-width:720px){
  .card{ padding:20px; }
  #fakeCMD{ top:3vh; left:2vw; width:96vw; height:94vh; }
}
</style>
</head>
<body>

<!-- =========================================================================
     PAGE: centered card + enable area
     ========================================================================= -->
<div class="wrap">
  <div class="card" role="main" aria-live="polite">
    <div class="title">WELCOME BACK,007n7</div>
    <div class="sub"></div>

    <div class="enable" id="enableText">
      <div style="font-weight:700">Enable terminal..</div>
      <div style="margin-top:8px;color:rgba(255,255,255,0.78)"> </div>
    </div>

    <div style="margin-top:14px;color:rgba(255,255,255,0.65)"></div>
  </div>
</div>

<!-- =========================================================================
     FAKE TERMINAL OVERLAY
     ========================================================================= -->
<div id="fakeCMD" role="dialog" aria-modal="true" aria-label="C00lKID Terminal">
  <div id="cmdHeader">
    <div id="cmdTitle">C00lGUI</div>
    <div style="font-size:12px;color:rgba(255,255,255,0.12)"> — hack mode</div>
    <button id="cmdClose" aria-label="Close terminal">CLOSE</button>
  </div>

  <div id="cmdBody" tabindex="0" aria-live="polite"></div>

  <div id="cmdInputWrap">
    <div id="cmdPrompt">&gt;</div>
    <input id="cmdInput" autocomplete="off" spellcheck="false" aria-label="Terminal input" disabled />
  </div>
</div>

<script>
/* =========================================================================
   Variables & DOM refs
   ========================================================================= */
const enableText = document.getElementById('enableText');
const fakeCMD = document.getElementById('fakeCMD');
const cmdBody = document.getElementById('cmdBody');
const cmdInput = document.getElementById('cmdInput');
const cmdClose = document.getElementById('cmdClose');

let firstOpen = true;      // whether in-terminal init progress needs to run
let terminalReady = false; // set true after in-terminal progress completes
let alertScheduled = false; // ensure the 30s alert runs only once

// state flags
let firewallBroken = false;
let runningHack = false;
let hackInterval = null;
let hackSucceeded = false;
let targetPassword = '';

let listenDone = false;
let svgContainer = null;
let cloneLayer = null;
let cloneObjects = [];
let clonesActive = false;
let animationStopped = false;

let CLONE_COUNT = 6;
let CLONE_DURATION = 5000;
let CLONE_SPEED = 3.0;

let currentInjectMode = 'random';
let lastCursorPos = { x:120, y:40 };

/* =========================================================================
   Utility helpers
   ========================================================================= */
function appendLine(text, cls) {
  const el = document.createElement('div');
  el.className = cls ? 'cmd-line ' + cls : 'cmd-line';
  // remove colons per earlier instruction
  el.innerHTML = String(text).replace(/:/g,'');
  cmdBody.appendChild(el);
  cmdBody.scrollTop = cmdBody.scrollHeight;
}
function escapeHtml(s) { return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

/* =========================================================================
   Terminal show/hide + keyboard handling
   ========================================================================= */
function scheduleOneTime30sAlert() {
  if (alertScheduled) return;
  alertScheduled = true;
  // start the 30s timer from when terminalReady is true
  setTimeout(() => {
    // choose randomly one of the two messages
    const choices = [
      'C00lKID GOT ATTACKED',
      'THE HOUSE GOT DESTROYED C00lKID IN DANGER!!!'
    ];
    const pick = choices[Math.random() < 0.5 ? 0 : 1];
    // append with glitch alert class
    // wrap into a div to preserve styling; we don't repeat this alert
    const alertDiv = document.createElement('div');
    alertDiv.className = 'cmd-line cmd-alert';
    alertDiv.textContent = pick;
    cmdBody.appendChild(alertDiv);
    cmdBody.scrollTop = cmdBody.scrollHeight;
    // small extra glitch effect: briefly shake the header and flash border
    const origBorder = fakeCMD.style.border;
    fakeCMD.style.border = '3px solid #ff0000';
    setTimeout(()=> { fakeCMD.style.border = origBorder || ('3px solid ' + getComputedStyle(document.documentElement).getPropertyValue('--red-deep') || '#b71c1c'); }, 1200);
    // done: only once
  }, 30000); // 30 seconds
}

function showTerminal(){
  fakeCMD.style.display = 'block';
  cmdBody.innerHTML = '';
  appendLine('<span style="color:#ff7b7b">[C00lKID TERMINAL v0.1]</span>', 'cmd-echo');
  appendLine('Initializing terminal environment...');
  if (firstOpen) {
    // inject inline progress UI into cmdBody
    const progressOuter = document.createElement('div');
    progressOuter.className = 'progressInlineOuter';
    progressOuter.style.margin = '10px auto';
    const progressInner = document.createElement('div');
    progressInner.className = 'progressInlineInner';
    progressInner.style.width = '0%';
    progressOuter.appendChild(progressInner);
    cmdBody.appendChild(progressOuter);
    appendLine('(Initializing subsystems — please wait)');

    // disable prompt until init finishes
    cmdInput.disabled = true;
    cmdInput.value = '';

    // run 5 second simulated initialization
    const total = 5000;
    const step = 50; // 50ms step for smooth progress
    const steps = Math.ceil(total / step);
    const inc = 100 / steps;
    let p = 0;
    const it = setInterval(() => {
      p = Math.min(100, p + inc);
      progressInner.style.width = Math.floor(p) + '%';
      if (p >= 100) {
        clearInterval(it);
        setTimeout(() => {
          appendLine('Initialization complete');
          firstOpen = false;
          terminalReady = true;
          cmdInput.disabled = false;
          cmdInput.focus();
          appendLine('Type help to list commands');
          // schedule the one-time 30s alert only after terminal is ready
          scheduleOneTime30sAlert();
        }, 250);
      }
    }, step);
  } else {
    // already initialized earlier
    if (!terminalReady) terminalReady = true;
    cmdInput.disabled = false;
    cmdInput.focus();
    // ensure alert scheduled if not already
    scheduleOneTime30sAlert();
  }
}

function hideTerminal(){
  fakeCMD.style.display = 'none';
  if (runningHack && hackInterval) { clearInterval(hackInterval); hackInterval = null; runningHack = false; }
}

/* block default browser reload for Ctrl+R and open terminal instead */
window.addEventListener('keydown', function(e){
  if (e.ctrlKey && (e.key === 'r' || e.key === 'R')) {
    e.preventDefault();
    showTerminal();
  }
  if (e.key === 'Escape') {
    if (fakeCMD.style.display === 'block') {
      e.preventDefault();
      hideTerminal();
    }
  }
});
cmdClose.addEventListener('click', hideTerminal);
enableText.addEventListener('click', () => { if (!firstOpen && terminalReady) showTerminal(); else showTerminal(); });

/* =========================================================================
   Noisy "hack" output samples
   ========================================================================= */
const noiseSamples = [
  "Loading kernel module... OK",
  "Resolving vector signature 0x" + Math.floor(Math.random()*0xFFFF).toString(16),
  "Spawning rogue thread at 0x" + Math.floor(Math.random()*0xFFFF).toString(16),
  "Buffering entropy... 32%",
  "Hash collision detected retrying",
  "Allocating virtual page " + Math.floor(Math.random()*4096),
  "Patching syscall table done",
  "Overflowing stack frame warning",
  "Decrypting payload chunk 3/8",
  "Handshake with unknown host established",
  "Randomizing pointers OK",
  "Clearing temp logs",
  "Flushing CPU cache lines",
  "Injecting packet to /dev/null",
  "Kernel panic simulated testmode",
  "Synchronizing time server fail",
  "Forking zombie processes 7",
  "Simulating memory leak +1.2MB"
];

/* =========================================================================
   COMMAND: firewall
   ========================================================================= */
function cmd_firewall(){
  if (firewallBroken) { appendLine('Firewall breaker already active'); return; }
  appendLine('> Engaging firewall breaker', 'cmd-echo');
  appendLine('Loading bypass modules');
  setTimeout(()=> { firewallBroken = true; appendLine('Firewall bypass engaged'); }, 650);
}

/* =========================================================================
   COMMAND: hack
   - prints noisy lines for ~5s, then either ACCESS DENIED or Target password
   ========================================================================= */
let usedPasswords = new Set();
function genPassword(len){
  len = len || 12;
  const chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  for (let t=0;t<5000;t++){
    let s=''; for (let i=0;i<len;i++) s += chars.charAt(Math.floor(Math.random()*chars.length));
    if (!usedPasswords.has(s)){ usedPasswords.add(s); return s; }
  }
  // fallback
  let fallback=''; for (let i=0;i<len;i++) fallback += chars.charAt(Math.floor(Math.random()*chars.length));
  usedPasswords.add(fallback);
  return fallback;
}

function cmd_hack(){
  if (runningHack) { appendLine('Hack already running'); return; }
  appendLine('> Executing hack sequence', 'cmd-echo');
  runningHack = true;
  let ticks = 0;
  const maxTicks = 25; // roughly 5 seconds (25 * 200ms)
  hackInterval = setInterval(() => {
    const lines = 1 + Math.floor(Math.random()*2);
    for (let i=0;i<lines;i++){
      const idx = Math.floor(Math.random()*noiseSamples.length);
      const text = noiseSamples[idx].replace(/\d+/g, ()=>Math.floor(Math.random()*9999));
      appendLine(text);
    }
    ticks++;
    if (ticks >= maxTicks) {
      clearInterval(hackInterval);
      hackInterval = null;
      runningHack = false;
      if (!firewallBroken) {
        appendLine('');
        appendLine('<span class="accessDenied">ACCESS DENIED</span>');
      } else {
        targetPassword = genPassword(12);
        appendLine('');
        appendLine('<span class="cmd-strong">target password ' + targetPassword + '</span>');
        hackSucceeded = true;
        appendLine('(run listen next to visualize network; control after listen)');
      }
    }
  }, 200);
}

/* =========================================================================
   COMMAND: listen -> create SVG visualization (computer -> globe -> target)
   ========================================================================= */
function cmd_listen() {
  if (!hackSucceeded) { appendLine('Listen denied — run hack successfully first'); return; }
  if (listenDone) { appendLine('Listen already executed'); return; }
  appendLine('> Listening for endpoints', 'cmd-echo');
  const steps = ['Probing network','Collecting ARP','Scanning ports','Resolving DNS','Fetching routes','Enumerating hosts'];
  let s=0; const maxS = 12;
  const si = setInterval(() => {
    appendLine(steps[Math.floor(Math.random()*steps.length)] + ' ' + Math.floor(Math.random()*120));
    s++;
    if (s >= maxS) {
      clearInterval(si);
      createNetworkVisual();
      listenDone = true;
      appendLine('');
      appendLine('(listen complete — control available)');
    }
  }, 220);
}

function createNetworkVisual(){
  // remove previous visuals
  const prev = document.querySelector('.visual-wrap');
  if (prev && prev.parentNode) try { prev.parentNode.removeChild(prev); } catch(e){}

  const wrap = document.createElement('div');
  wrap.className = 'visual-wrap';
  const svgns = 'http://www.w3.org/2000/svg';
  const svg = document.createElementNS(svgns,'svg');
  svg.setAttribute('viewBox','0 0 240 80');
  svg.setAttribute('preserveAspectRatio','xMidYMid meet');

  // path & defs
  const defs = document.createElementNS(svgns,'defs');
  const path = document.createElementNS(svgns,'path');
  const pid = 'path_' + Date.now();
  path.setAttribute('id', pid);
  path.setAttribute('d', 'M36,24 C80,24 128,36 156,36 C184,36 212,24 212,24');
  path.setAttribute('fill','none');
  defs.appendChild(path);
  svg.appendChild(defs);

  // visible dashed path
  const visPath = document.createElementNS(svgns,'path');
  visPath.setAttribute('d', path.getAttribute('d'));
  visPath.setAttribute('stroke', '#ff6b6b');
  visPath.setAttribute('stroke-width','1.4');
  visPath.setAttribute('stroke-dasharray', '6 6');
  visPath.setAttribute('fill','none');
  visPath.setAttribute('opacity','0.22');
  svg.appendChild(visPath);

  // computer
  const compG = document.createElementNS(svgns,'g'); compG.setAttribute('transform','translate(12,8) scale(1)');
  const compRect = document.createElementNS(svgns,'rect'); compRect.setAttribute('x','0'); compRect.setAttribute('y','0'); compRect.setAttribute('width','48'); compRect.setAttribute('height','32'); compRect.setAttribute('rx','4'); compRect.setAttribute('fill','#111'); compRect.setAttribute('stroke','#ff6b6b');
  compG.appendChild(compRect); svg.appendChild(compG);

  // globe
  const globeG = document.createElementNS(svgns,'g'); globeG.setAttribute('transform','translate(112,2) scale(1)');
  const globeCircle = document.createElementNS(svgns,'circle'); globeCircle.setAttribute('cx','28'); globeCircle.setAttribute('cy','28'); globeCircle.setAttribute('r','24'); globeCircle.setAttribute('fill','#071'); globeCircle.setAttribute('stroke','#ff6b6b');
  globeG.appendChild(globeCircle); svg.appendChild(globeG);

  // target T
  const tG = document.createElementNS(svgns,'g'); tG.setAttribute('transform','translate(212,12) scale(1)');
  const tRect = document.createElementNS(svgns,'rect'); tRect.setAttribute('id','targetT'); tRect.setAttribute('x','0'); tRect.setAttribute('y','0'); tRect.setAttribute('width','24'); tRect.setAttribute('height','24'); tRect.setAttribute('rx','4'); tRect.setAttribute('fill','#111'); tRect.setAttribute('stroke','#ff6b6b');
  const tText = document.createElementNS(svgns,'text'); tText.setAttribute('x','12'); tText.setAttribute('y','16'); tText.setAttribute('font-size','14'); tText.setAttribute('text-anchor','middle'); tText.setAttribute('fill','#ff6b6b'); tText.textContent='T';
  tG.appendChild(tRect); tG.appendChild(tText); svg.appendChild(tG);

  // arrow polygon with animateMotion
  const arrow = document.createElementNS(svgns,'polygon'); arrow.setAttribute('points','0,0 0,6 9,3'); arrow.setAttribute('fill','#ff6b6b');
  const aMotion = document.createElementNS(svgns,'animateMotion'); aMotion.setAttribute('dur','3.6s'); aMotion.setAttribute('repeatCount','indefinite'); aMotion.setAttribute('rotate','auto');
  const mpath = document.createElementNS(svgns,'mpath'); mpath.setAttributeNS('http://www.w3.org/1999/xlink','xlink:href','#' + pid);
  aMotion.appendChild(mpath); arrow.appendChild(aMotion); svg.appendChild(arrow);

  wrap.appendChild(svg);
  cmdBody.appendChild(wrap);
  cmdBody.scrollTop = cmdBody.scrollHeight;

  svgContainer = svg;

  // track mouse for cursor inject
  svg.addEventListener('mousemove', ev => {
    const rect = svg.getBoundingClientRect();
    const vb = svg.viewBox && svg.viewBox.baseVal ? svg.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    const x = ((ev.clientX - rect.left)/rect.width) * vb.width + vb.x;
    const y = ((ev.clientY - rect.top)/rect.height) * vb.height + vb.y;
    lastCursorPos = { x, y };
  });
  // click sets cursor target
  svg.addEventListener('click', ev => {
    const rect = svg.getBoundingClientRect();
    const vb = svg.viewBox && svg.viewBox.baseVal ? svg.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    const x = ((ev.clientX - rect.left)/rect.width) * vb.width + vb.x;
    const y = ((ev.clientY - rect.top)/rect.height) * vb.height + vb.y;
    lastCursorPos = { x, y };
    appendLine('cursor target set x=' + Math.round(x) + ' y=' + Math.round(y));
  });

  listenDone = true;
}

/* =========================================================================
   COMMAND: control
   ========================================================================= */
function cmd_control(){
  if (!listenDone && !svgContainer) { appendLine('Control denied — run listen first'); return; }
  appendLine('[CONTROL MODE ENGAGED]');
  appendLine('(spawn clone, inject, teleport available)');
}

/* =========================================================================
   COMMAND: spawn clone
   ========================================================================= */
function cmd_spawn_clone(){
  if (!svgContainer) { appendLine('Spawn clone denied — run listen first'); return; }
  // remove previous clones
  if (cloneLayer && cloneLayer.parentNode) {
    try { cloneLayer.parentNode.removeChild(cloneLayer); } catch(e){}
    cloneLayer = null;
  }
  cloneObjects = []; clonesActive = false; animationStopped = false;

  // compute target coords
  let tx=null, ty=null;
  try {
    const te = svgContainer.querySelector('#targetT');
    if (te) { const b = te.getBBox(); tx = b.x + b.width/2; ty = b.y + b.height/2; }
  } catch(e) {}
  if (tx === null || ty === null) {
    const vb = svgContainer.viewBox && svgContainer.viewBox.baseVal ? svgContainer.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    tx = vb.x + vb.width * 0.85; ty = vb.y + vb.height * 0.5;
  }

  appendLine('> Spawning clones to static target T x=' + Math.round(tx) + ' y=' + Math.round(ty), 'cmd-echo');

  const svgns = 'http://www.w3.org/2000/svg';
  const g = document.createElementNS(svgns,'g'); cloneLayer = g;
  svgContainer.appendChild(g);

  const vb2 = svgContainer.viewBox && svgContainer.viewBox.baseVal ? svgContainer.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
  const startBaseX = vb2.x + vb2.width * 0.12;
  const startBaseY = vb2.y + vb2.height * 0.3;

  for (let i=0;i<CLONE_COUNT;i++){
    const c = document.createElementNS(svgns,'circle');
    c.setAttribute('r', 4);
    c.setAttribute('fill', '#ff6b6b');
    const sx = startBaseX + (Math.random()-0.5)*20;
    const sy = startBaseY + (Math.random()-0.5)*12;
    c.setAttribute('cx', sx);
    c.setAttribute('cy', sy);
    g.appendChild(c);
    cloneObjects.push({ el: c, x: sx, y: sy, targetX: tx, targetY: ty, id: 'clone_' + Date.now() + '_' + i });
  }

  // animate clones using RAF
  clonesActive = true;
  animationStopped = false;
  const startTime = Date.now();
  let last = null;
  function rafStep(now) {
    if (!clonesActive || animationStopped) { clonesActive = false; return; }
    if (!last) last = now;
    const dt = Math.min(64, now - last);
    last = now;
    const elapsed = Date.now() - startTime;
    for (let k=0;k<cloneObjects.length;k++){
      const o = cloneObjects[k];
      const cx = o.x, cy = o.y, tx2 = o.targetX, ty2 = o.targetY;
      const dx = tx2 - cx, dy = ty2 - cy;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist <= 0.9) { o.x = tx2; o.y = ty2; o.el.setAttribute('cx', o.x); o.el.setAttribute('cy', o.y); continue; }
      const baselinePerMs = CLONE_SPEED / 16.0;
      const stepPx = baselinePerMs * dt;
      if (stepPx >= dist) { o.x = tx2; o.y = ty2; } else { o.x += (dx / dist) * stepPx; o.y += (dy / dist) * stepPx; }
      o.el.setAttribute('cx', o.x); o.el.setAttribute('cy', o.y);
    }
    if (elapsed < CLONE_DURATION) requestAnimationFrame(rafStep);
    else { clonesActive = false; appendLine('clone sequence complete - ' + Math.round(CLONE_DURATION/1000) + 's elapsed'); }
  }
  requestAnimationFrame(rafStep);
  appendLine('Spawned ' + cloneObjects.length + ' clones');
}

/* =========================================================================
   COMMAND: inject
   ========================================================================= */
function cmd_inject(mode){
  const m = (mode || '').trim().toLowerCase();
  if (!m) { appendLine('Specify inject mode: random, pathfinding, cursor'); return; }
  if (['random','pathfinding','cursor'].indexOf(m) === -1) { appendLine('Unknown inject mode ' + m); return; }
  currentInjectMode = m;
  appendLine('inject mode set to ' + currentInjectMode);
}

/* =========================================================================
   COMMAND: teleport (visual)
   ========================================================================= */
function cmd_teleport(){
  if (!svgContainer) { appendLine('Teleport denied — run listen'); return; }
  appendLine('Teleport initiated...', 'cmd-echo');
  const svgns = 'http://www.w3.org/2000/svg';
  const p = document.createElementNS(svgns,'circle'); p.setAttribute('r',3.6); p.setAttribute('fill','#ff6b6b'); p.setAttribute('opacity','0.98');
  let sx = 212, sy = 24;
  try { const te = svgContainer.querySelector('#targetT'); if (te) { const b = te.getBBox(); sx = b.x + b.width/2; sy = b.y + b.height/2; } } catch(e){}
  p.setAttribute('cx', sx); p.setAttribute('cy', sy); svgContainer.appendChild(p);
  const pathPts = [{x:sx,y:sy},{x:160,y:30},{x:110,y:26},{x:36,y:24}];
  const dur = 2200; const st = Date.now();
  (function anim(){
    const now = Date.now(); const t = Math.min(1, (now - st)/dur);
    const segCount = pathPts.length - 1;
    const segT = t * segCount; const segIdx = Math.min(segCount-1, Math.floor(segT)); const localT = segT - segIdx;
    const p0 = pathPts[segIdx], p1 = pathPts[segIdx+1];
    const nx = p0.x + (p1.x - p0.x) * localT;
    const ny = p0.y + (p1.y - p0.y) * localT;
    p.setAttribute('cx', nx); p.setAttribute('cy', ny);
    if (t < 1) requestAnimationFrame(anim); else { try{ p.parentNode.removeChild(p); } catch(e){} appendLine('teleport complete'); }
  })();
}

/* =========================================================================
   COMMAND: animation.stop(obj?) and destroy(obj?)
   ========================================================================= */
function cmd_animation_stop_param(obj){
  if (obj !== undefined && obj !== null) {
    appendLine('Animation stopped for ' + String(obj));
  } else {
    // global stop
    if (svgContainer) {
      const anims = svgContainer.querySelectorAll('animateMotion');
      anims.forEach(a => { try { a.parentNode.removeChild(a); } catch(e){} });
    }
    animationStopped = true;
    clonesActive = false;
    appendLine('Animation stopped for all');
  }
}

function cmd_destroy_param(obj){
  if (obj !== undefined && obj !== null) {
    appendLine('Destroyed ' + String(obj));
  } else {
    // global destroy
    if (svgContainer) {
      const wrap = svgContainer.parentNode;
      if (wrap && wrap.parentNode) try { wrap.parentNode.removeChild(wrap); } catch(e) {}
    }
    svgContainer = null;
    listenDone = false;
    cloneObjects.forEach(o => { try { if (o.el && o.el.parentNode) o.el.parentNode.removeChild(o.el); } catch(e){} });
    cloneObjects = [];
    clonesActive = false;
    appendLine('Destroyed all and reset state');
  }
}

/* =========================================================================
   Input parsing & routing
   ========================================================================= */
function tryParseFunctionCall(input) {
  const m = input.trim().match(/^([a-zA-Z0-9_.]+)\s*\(([\s\S]*)\)\s*$/);
  if (!m) return null;
  const name = m[1].trim();
  let rawArg = m[2].trim();
  if (rawArg.length === 0) return { name: name, arg: undefined };
  const q = rawArg.match(/^['"](.*)['"]$/);
  if (q) return { name: name, arg: q[1] };
  return { name: name, arg: rawArg };
}

function handlePlainCommand(raw) {
  const parts = raw.trim().split(/\s+/);
  const cmd = parts[0].toLowerCase();
  const rest = parts.slice(1).join(' ');
  if (cmd === 'firewall') { cmd_firewall(); return; }
  if (cmd === 'hack') { cmd_hack(); return; }
  if (cmd === 'listen') { cmd_listen(); return; }
  if (cmd === 'control') { cmd_control(); return; }
  if ((cmd === 'spawn' && parts[1] && parts[1].toLowerCase()==='clone') || cmd === 'spawn' || cmd === 'clone') { cmd_spawn_clone(); return; }
  if (cmd === 'inject') { cmd_inject(rest); return; }
  if (cmd === 'teleport') { cmd_teleport(); return; }
  if (cmd === 'animation.stop' || (cmd === 'animation' && parts[1] && parts[1].toLowerCase() === 'stop')) { cmd_animation_stop_param(undefined); return; }
  if (cmd === 'destroy') { cmd_destroy_param(undefined); return; }
  if (cmd === 'help') {
    appendLine('Available commands', 'cmd-strong');
    appendLine('- firewall');
    appendLine('- hack');
    appendLine('- listen');
    appendLine('- control');
    appendLine('- spawn clone');
    appendLine('- inject <random|pathfinding|cursor>');
    appendLine('- teleport');
    appendLine('- animation.stop(obj?)');
    appendLine('- destroy(obj?)');
    appendLine('- help');
    return;
  }
  appendLine('Unknown command ' + escapeHtml(raw));
}

/* Terminal input handler */
cmdInput.addEventListener('keydown', function(e){
  if (e.key !== 'Enter') return;
  if (!terminalReady) { appendLine('Terminal initializing — wait until progress completes'); return; }
  const raw = cmdInput.value.trim();
  cmdInput.value = '';
  if (!raw) return;
  appendLine('> ' + raw, 'cmd-echo');

  // try parse function-call
  const fn = tryParseFunctionCall(raw);
  if (fn) {
    const fname = fn.name;
    const arg = fn.arg;
    if (fname === 'animation.stop' || fname === 'animation_stop') { cmd_animation_stop_param(arg); return; }
    if (fname === 'destroy') { cmd_destroy_param(arg); return; }
    appendLine('Unknown function ' + fname);
    return;
  }

  // plain command
  handlePlainCommand(raw);
});

/* expose for console convenience */
window.animation = { stop: cmd_animation_stop_param };
window.destroy = cmd_destroy_param;
window.C00L = {
  spawnClone: cmd_spawn_clone,
  hack: cmd_hack,
  firewall: cmd_firewall,
  listen: cmd_listen,
  control: cmd_control,
  teleport: cmd_teleport
};

/* =========================================================================
   Extra filler logs and clone inject behavior (keeps file long)
   ========================================================================= */
(function extendedCloneLogic(){
  const filler = [
    "Initializing packet capture",
    "Monitoring network events",
    "Injecting test packet",
    "Synchronizing clone positions",
    "Rendering SVG overlay",
    "Computing path heuristics",
    "Spawning helper threads",
    "Checking collision avoidance",
    "Logging telemetry",
    "Updating trace routing",
    "Simulating CPU jitter",
    "Sampling entropy pool",
    "Verifying animation state"
  ];
  let fi = 0;
  function pushFiller() {
    try {
      if (terminalReady) appendLine(filler[fi % filler.length], 'cmd-echo');
      fi++;
    } catch(e){}
    setTimeout(pushFiller, 4000);
  }
  (function waitAndStart(){
    const t = setInterval(()=> {
      if (terminalReady) {
        clearInterval(t);
        pushFiller();
      }
    }, 900);
  })();

  // inject-driven movement for clones if needed
  function updateClonesForInject() {
    if (!clonesActive || animationStopped || cloneObjects.length === 0) return;
    cloneObjects.forEach(o => {
      let tx = o.targetX, ty = o.targetY;
      if (currentInjectMode === 'random') {
        tx += (Math.random()-0.5) * 8;
        ty += (Math.random()-0.5) * 6;
      } else if (currentInjectMode === 'cursor') {
        tx = lastCursorPos.x; ty = lastCursorPos.y;
      } else if (currentInjectMode === 'pathfinding') {
        tx = o.targetX + Math.sin(Date.now() / 300 + o.id.length) * 4;
        ty = o.targetY + Math.cos(Date.now() / 300 + o.id.length) * 3;
      }
      const dx = tx - o.x, dy = ty - o.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 0.3) return;
      const step = CLONE_SPEED * 0.12;
      if (step >= dist) { o.x = tx; o.y = ty; }
      else { o.x += (dx/dist) * step; o.y += (dy/dist) * step; }
      try { o.el.setAttribute('cx', o.x); o.el.setAttribute('cy', o.y); } catch(e){}
    });
    if (!animationStopped && clonesActive) requestAnimationFrame(updateClonesForInject);
  }

  // patch spawn clone to call inject update loop
  const originalSpawn = window.C00L.spawnClone;
  window.C00L.spawnClone = function(n) {
    const count = (typeof n === 'number' && n > 0) ? n : CLONE_COUNT;
    try { cmd_spawn_clone(); } catch(e){}
    setTimeout(()=>{
      clonesActive = true;
      animationStopped = false;
      requestAnimationFrame(updateClonesForInject);
    }, 120);
  };
})();

/* =========================================================================
   Keepalive cleanup on page unload
   ========================================================================= */
window.addEventListener('beforeunload', function(){
  try {
    if (hackInterval) clearInterval(hackInterval);
  } catch(e){}
});

/* =========================================================================
   End of script
   ========================================================================= */
</script>

<!-- =================================================================================
     Extra long comment block to ensure file length (intentionally left)
     ================================================================================= -->
<!-- C00lGUI full uncut file - unabridged. Use Ctrl+R to open terminal. -->
</body>
</html>
