<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>C00lGUI</title>
<style>
/* =========================================================================
   THEME + LAYOUT
   A long explicit stylesheet is included to be verbose and clear.
   This section intentionally contains many small rule blocks to increase
   readability and file size (as requested).
   ========================================================================= */
:root{
  --bg:#050405;
  --card:#0b0b0b;
  --accent:#ff6b6b;
  --red:#ff3b3b;
  --red-deep:#b71c1c;
  --muted:rgba(255,255,255,0.92);
  --mono:"Courier New", Courier, monospace;
  --glass: rgba(255,255,255,0.02);
  --glass-2: rgba(255,255,255,0.01);
}

*{box-sizing:border-box}
html,body{height:100%;margin:0;background:
 radial-gradient(ellipse at center,#0f0f12 0%, #020202 60%),
 linear-gradient(180deg,#060003 0%, #000 100%);
 color:var(--muted); font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

/* Page wrapper */
.wrap {
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:28px;
}

/* Card container */
.card {
  width:1040px;
  max-width:96%;
  background: linear-gradient(180deg, var(--glass), var(--glass-2));
  border-radius:12px;
  padding:28px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 30px 90px rgba(0,0,0,0.6);
  text-align:center;
  overflow:visible;
}

/* Title area */
.title {
  font-size:32px;
  color:var(--red-deep);
  font-weight:900;
  margin:0 0 6px 0;
  text-shadow: 0 0 20px rgba(255,80,80,0.14);
}

/* Subtitle */
.subtitle {
  font-size:14px;
  color:rgba(255,255,255,0.78);
  margin:6px 0 16px 0;
}

/* Enable terminal control (clickable) */
#enableTerminal {
  display:inline-block;
  padding:12px 16px;
  border-radius:8px;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.03);
}
#enableTerminal:focus { outline:none; box-shadow: 0 0 0 8px rgba(255,107,107,0.06); }

/* Loading progress bar */
.progressOuter {
  width:88%;
  max-width:760px;
  margin:18px auto 6px auto;
  height:14px;
  background: rgba(255,255,255,0.02);
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.02);
  overflow:hidden;
}
.progressInner {
  height:100%;
  width:0%;
  background: linear-gradient(90deg,var(--accent),var(--red));
  transition: width 80ms linear;
}

/* Small hint line */
.hint {
  color:rgba(255,255,255,0.68);
  font-size:13px;
  margin-top:8px;
}

/* Fake terminal overlay */
#fakeCMD {
  display:none;
  position:fixed;
  top:6vh;
  left:6vw;
  width:88vw;
  height:88vh;
  max-width:1280px;
  max-height:920px;
  background:#070404;
  border:3px solid var(--red-deep);
  box-shadow: 0 40px 160px rgba(183,28,28,0.35);
  z-index:99999;
  border-radius:10px;
  overflow:hidden;
  font-family:var(--mono);
  color:var(--red);
}

/* Terminal header */
#cmdHeader {
  display:flex;
  gap:12px;
  align-items:center;
  padding:12px 16px;
  background: linear-gradient(90deg, rgba(255,0,0,0.02), rgba(255,0,0,0.01));
  border-bottom:1px solid rgba(255,0,0,0.04);
}
#cmdTitle { font-weight:900; color:var(--red-deep); font-size:16px; }
#cmdClose { margin-left:auto; background:transparent; border:none; color:var(--red); font-weight:700; cursor:pointer; padding:8px 12px; border-radius:6px; }
#cmdClose:hover { background:rgba(255,0,0,0.03); }

/* Terminal body */
#cmdBody {
  padding:16px;
  height: calc(100% - 128px);
  overflow:auto;
  white-space:pre-wrap;
  font-size:14px;
  line-height:1.45;
  color:var(--red);
  background: linear-gradient(180deg,#040303 0%, #000 100%);
}

/* Terminal scrollbar styling (webkit) */
#cmdBody::-webkit-scrollbar { width:12px; height:12px; }
#cmdBody::-webkit-scrollbar-track { background: rgba(0,0,0,0.15); border-radius:6px; }
#cmdBody::-webkit-scrollbar-thumb { background: linear-gradient(180deg, rgba(255,59,59,0.18), rgba(183,28,28,0.28)); border-radius:6px; border:2px solid rgba(0,0,0,0.14); }

/* Input row */
#cmdInputWrap { padding:10px 16px 18px 16px; border-top:1px solid rgba(255,0,0,0.03); display:flex; gap:8px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); }
#cmdPrompt { color:var(--red); font-family:var(--mono); font-size:14px; }
#cmdInput { flex:1; background:transparent; border:none; outline:none; color:var(--red); font-family:var(--mono); font-size:14px; }

/* Visual wrapper for SVGs inserted into terminal */
.visual-wrap { margin:12px 0; display:flex; justify-content:center; align-items:center; }
.visual-wrap svg { width:88%; max-width:880px; height:auto; display:block; background:#020202; border-radius:6px; border:1px solid rgba(255,255,255,0.02); }

/* small helpers */
.cmd-line { margin:6px 0; font-family:var(--mono); color:var(--red); }
.cmd-echo { color:var(--red); font-weight:600; }
.cmd-strong { color:var(--red); font-weight:800; }
.accessDenied { display:block; margin-top:8px; font-weight:900; font-size:34px; color:#ff4d4d; text-shadow:0 0 18px rgba(255,0,0,0.18); letter-spacing:2px; }

kbd { background:rgba(255,255,255,0.03); padding:2px 6px; border-radius:6px; font-family:var(--mono); font-size:12px; color:var(--muted); }

@media (max-width:720px){
  .card { padding:16px; }
  .visual-wrap svg { width:100%; }
  #fakeCMD { top:3vh; left:2vw; width:96vw; height:94vh; }
}
</style>
</head>
<body>
  <!--
    ========================================================================
    PAGE CONTENT START
    ========================================================================
    The page contains a centered card with a large "Enable terminal.." control,
    a visual progress bar that runs for 5 seconds and then allows the terminal
    to be opened (Ctrl+R or click).
    ========================================================================
  -->
  <div class="wrap">
    <div class="card" role="main" aria-live="polite">
      <div class="title">WELCOME,007n7</div>
      <div class="subtitle">what do u want to do now</div>

      <div id="enableTerminal" role="button" tabindex="0" aria-pressed="false">Enable terminal..</div>

      <div class="progressOuter" aria-hidden="false" style="margin-top:18px;">
        <div id="progressFill" class="progressInner" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
      </div>

      <div class="hint">hack or play with C00lKID</div>
    </div>
  </div>

  <!-- FAKE TERMINAL -->
  <div id="fakeCMD" role="dialog" aria-modal="true" aria-label="C00lKID Terminal">
    <div id="cmdHeader">
      <div id="cmdTitle">C00lKID TERMINAL</div>
      <div style="font-size:12px;color:rgba(255,255,255,0.12);"> — debug & simulation mode</div>
      <button id="cmdClose" aria-label="Close terminal">CLOSE</button>
    </div>

    <div id="cmdBody" tabindex="0" aria-live="polite"></div>

    <div id="cmdInputWrap">
      <div id="cmdPrompt">&gt;</div>
      <input id="cmdInput" autocomplete="off" spellcheck="false" aria-label="Terminal input" />
    </div>
  </div>

<script>
/* =========================================================================
   FULL JAVASCRIPT — verbose, non-truncated, many comments and logs to
   intentionally produce a long, explicit, and easily editable single file.
   This script implements all of:
   - initialization progress (5s)
   - terminal open/close (Enable terminal.. or Ctrl+R)
   - commands: firewall, hack, listen, control, spawn clone, inject, teleport, help
   - SVG network visualization (computer -> globe -> target)
   - clones spawn and move toward static target T
   - inject modes supported (random, pathfinding, cursor)
   - many verbose logs and comments for clarity
   ========================================================================= */

/* -------------------------------------------------------------------------
   Element references
   ------------------------------------------------------------------------- */
const enableTerminalEl = document.getElementById('enableTerminal');
const progressFillEl = document.getElementById('progressFill');
const fakeCMD = document.getElementById('fakeCMD');
const cmdBody = document.getElementById('cmdBody');
const cmdInput = document.getElementById('cmdInput');
const cmdClose = document.getElementById('cmdClose');

/* -------------------------------------------------------------------------
   Global state variables
   ------------------------------------------------------------------------- */
/* Initialization */
let initialized = false;
let initIntervalRef = null;
let initProgress = 0;

/* Security / flow flags */
let firewallBroken = false;   // set by 'firewall' command
let hackAttempted = false;
let hackSuccessful = false;   // set to true if hack succeeds (firewall was broken at completion)
let targetPassword = null;    // generated when hack succeeds

/* Listen/visual/control/clones */
let listenDone = false;
let svgContainer = null;      // SVG element created during listen
let svgViewBox = { w:240, h:80 };
let controlActive = false;
let clonesActive = false;
let cloneObjects = [];        // array of clone metadata objects

/* Clone parameters - configurable */
let CLONE_COUNT = 6;
let CLONE_DURATION = 5000;    // ms
let CLONE_SPEED = 3.0;        // baseline speed */

/* Inject mode */
let currentInjectMode = 'random'; // 'random' | 'pathfinding' | 'cursor'
let lastCursorPos = { x: 120, y: 40 };

/* Helper: capture many generated passwords to avoid duplicates in session */
const generatedPasswords = new Set();

/* Internal: hack timers */
let hackIntervalRef = null;
let runningHack = false;

/* -------------------------------------------------------------------------
   Utility functions
   ------------------------------------------------------------------------- */

/**
 * appendLine(text, cls)
 * Adds a line into the terminal body. Removes literal colon ":" characters
 * (as you requested earlier) so displayed text will not contain ":".
 * cls is optional class name(s) such as 'cmd-echo', 'cmd-strong'
 */
function appendLine(text, cls) {
  const el = document.createElement('div');
  el.className = cls ? 'cmd-line ' + cls : 'cmd-line';
  // remove colon characters
  const safe = String(text).replace(/:/g,'');
  el.innerHTML = safe;
  cmdBody.appendChild(el);
  cmdBody.scrollTop = cmdBody.scrollHeight;
}

/**
 * escapeHtml - small helper for safe echoing
 */
function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, function (m) { return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m]; });
}

/* -------------------------------------------------------------------------
   Initialization (5-second progress)
   ------------------------------------------------------------------------- */
(function startInitialization() {
  const totalMs = 5000;
  const stepMs = 75;
  const steps = Math.ceil(totalMs / stepMs);
  const inc = 100 / steps;
  initProgress = 0;
  progressFillEl.style.width = '0%';
  progressFillEl.setAttribute('aria-valuenow','0');

  initIntervalRef = setInterval(function(){
    initProgress = Math.min(100, initProgress + inc);
    progressFillEl.style.width = Math.floor(initProgress) + '%';
    progressFillEl.setAttribute('aria-valuenow', Math.floor(initProgress));
    if(initProgress >= 100) {
      clearInterval(initIntervalRef);
      initIntervalRef = null;
      initialized = true;
      // Do not auto-open terminal — user must click or press Ctrl+R
      // but put an unobtrusive invisible sentinel for accessibility
      // We intentionally do not append a visible line here to keep UI clean.
    }
  }, stepMs);
})();

/* -------------------------------------------------------------------------
   Terminal open/hide functions
   ------------------------------------------------------------------------- */
function showTerminal() {
  if(!initialized) {
    // visual pulse feedback to indicate not ready yet
    enableTerminalEl.animate([{ transform:'scale(0.985)'},{transform:'scale(1)'}],{ duration:160 });
    return;
  }
  fakeCMD.style.display = 'block';
  cmdBody.innerHTML = '';
  appendLine('<span style="color:#ff7b7b">[C00lKID TERMINAL v0.1]</span>', 'cmd-echo');
  // do not print usage instructions (user asked to remove them)
  cmdInput.focus();
}

function hideTerminal() {
  fakeCMD.style.display = 'none';
  // stop hack if running
  if(hackIntervalRef) {
    clearInterval(hackIntervalRef);
    hackIntervalRef = null;
    runningHack = false;
  }
}

/* Hook enableTerminal click/keyboard */
if(enableTerminalEl) {
  enableTerminalEl.addEventListener('click', function(){ showTerminal(); });
  enableTerminalEl.addEventListener('keydown', function(e){
    if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showTerminal(); }
  });
}

/* Hook Ctrl+R and Escape */
window.addEventListener('keydown', function(e){
  if(e.ctrlKey && e.key.toLowerCase() === 'r') {
    e.preventDefault();
    showTerminal();
  }
  if(e.key === 'Escape') {
    if(fakeCMD.style.display === 'block') hideTerminal();
  }
});
cmdClose.addEventListener('click', hideTerminal);

/* -------------------------------------------------------------------------
   Command implementations (verbose)
   ------------------------------------------------------------------------- */

/* FIREWALL - engages firewall breaker (simulated) */
function cmd_firewall() {
  if(firewallBroken) {
    appendLine('Firewall already disabled');
    return;
  }
  appendLine('> Engaging firewall breaker', 'cmd-echo');
  appendLine('Loading bypass modules');
  appendLine('Patching packet filters and ACLs');
  appendLine('Applying temporary kernel shims');
  setTimeout(function(){
    firewallBroken = true;
    appendLine('Firewall breaker engaged You may now run hack');
  }, 650);
}

/* HACK - simulated noisy sequence (~5s)
   If firewallBroken was false at the end -> ACCESS DENIED
   If firewallBroken true -> generate target password and mark success
*/
function cmd_hack() {
  if(runningHack) { appendLine('Hack already running'); return; }
  appendLine('> Executing hack sequence', 'cmd-echo');
  runningHack = true;
  hackAttempted = true;

  let ticks = 0;
  const maxTicks = 25;
  const noise = [
    'Loading kernel module OK',
    'Resolving vector signature 0x' + Math.floor(Math.random() * 0xFFFF).toString(16),
    'Spawning rogue thread',
    'Buffering entropy 32%',
    'Hash collision detected retrying',
    'Allocating virtual page',
    'Patching syscall table done',
    'Overflowing stack frame warning',
    'Decrypting payload chunk',
    'Handshake with unknown host',
    'Randomizing pointers OK',
    'Clearing temp logs',
    'Flushing CPU cache lines'
  ];

  hackIntervalRef = setInterval(function(){
    const lines = 1 + Math.floor(Math.random() * 2);
    for(let i=0;i<lines;i++){
      const idx = Math.floor(Math.random() * noise.length);
      const text = noise[idx].replace(/\d+/g, function(){ return Math.floor(Math.random()*9999); });
      appendLine(text);
    }
    ticks++;
    if(ticks >= maxTicks) {
      clearInterval(hackIntervalRef);
      hackIntervalRef = null;
      runningHack = false;
      if(!firewallBroken){
        appendLine('');
        appendLine('<span class="accessDenied">ACCESS DENIED</span>');
        appendLine('Hack sequence terminated due to active firewall');
        hackSuccessful = false;
      } else {
        targetPassword = genUniquePassword(12);
        appendLine('');
        appendLine('<span class="cmd-strong">target password ' + targetPassword + '</span>');
        hackSuccessful = true;
        appendLine('(run listen next to visualize network; control available after listen)');
      }
    }
  }, 200);
}

/* Helper: generate unique pseudo-random password (client-only) */
function genUniquePassword(len) {
  len = len || 12;
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  for(let attempt=0; attempt<5000; attempt++){
    let s = '';
    for(let i=0;i<len;i++) s += chars.charAt(Math.floor(Math.random()*chars.length));
    if(!generatedPasswords.has(s)){ generatedPasswords.add(s); return s; }
  }
  // fallback
  let fb='';
  for(let i=0;i<len;i++) fb += chars.charAt(Math.floor(Math.random()*chars.length));
  generatedPasswords.add(fb);
  return fb;
}

/* LISTEN - simulate discovery and create SVG visual (computer->globe->target) */
function cmd_listen() {
  if(!hackSuccessful) {
    appendLine('Listen denied — run hack and succeed first');
    return;
  }
  if(listenDone) {
    appendLine('Listen already completed');
    return;
  }
  appendLine('> Listening for network endpoints', 'cmd-echo');

  const steps = [
    'Probing local network',
    'Gathering ARP table',
    'Scanning ports',
    'Resolving DNS entries',
    'Fetching routing table',
    'Estimating latency to hosts',
    'Collecting service banners',
    'Enumerating remote hosts'
  ];
  let s = 0;
  const maxS = 14;
  const si = setInterval(function(){
    const idx = Math.floor(Math.random()*steps.length);
    appendLine(steps[idx] + ' ' + Math.floor(Math.random()*100));
    s++;
    if(s >= maxS) {
      clearInterval(si);
      createNetworkVisual();
      listenDone = true;
      appendLine('');
      appendLine('(listen complete — control available)');
    }
  }, 220);
}

/* createNetworkVisual - build SVG showing computer->globe->target and moving arrow */
function createNetworkVisual(){
  const wrapper = document.createElement('div');
  wrapper.className = 'visual-wrap';

  const svgns = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgns,'svg');
  svg.setAttribute('viewBox','0 0 240 80');
  svg.setAttribute('preserveAspectRatio','xMidYMid meet');

  // defs and motion path
  const defs = document.createElementNS(svgns,'defs');
  const motionPath = document.createElementNS(svgns,'path');
  const pathId = 'networkPath_' + Date.now();
  motionPath.setAttribute('id', pathId);
  motionPath.setAttribute('d', 'M36,24 C80,24 128,36 156,36 C184,36 212,24 212,24');
  motionPath.setAttribute('fill','none');
  motionPath.setAttribute('stroke','none');
  defs.appendChild(motionPath);
  svg.appendChild(defs);

  // dashed visible path
  const visiblePath = document.createElementNS(svgns,'path');
  visiblePath.setAttribute('d', motionPath.getAttribute('d'));
  visiblePath.setAttribute('stroke','#ff6b6b');
  visiblePath.setAttribute('stroke-width','1.4');
  visiblePath.setAttribute('stroke-dasharray','6 6');
  visiblePath.setAttribute('fill','none');
  visiblePath.setAttribute('opacity','0.22');
  svg.appendChild(visiblePath);

  // computer
  const compG = document.createElementNS(svgns,'g');
  compG.setAttribute('transform','translate(12,8) scale(1)');
  const compRect = document.createElementNS(svgns,'rect');
  compRect.setAttribute('x','0'); compRect.setAttribute('y','0'); compRect.setAttribute('width','48'); compRect.setAttribute('height','32'); compRect.setAttribute('rx','4'); compRect.setAttribute('fill','#111'); compRect.setAttribute('stroke','#ff6b6b');
  compG.appendChild(compRect);
  svg.appendChild(compG);

  // globe
  const globeG = document.createElementNS(svgns,'g');
  globeG.setAttribute('transform','translate(112,2) scale(1)');
  const globeCircle = document.createElementNS(svgns,'circle');
  globeCircle.setAttribute('cx','28'); globeCircle.setAttribute('cy','28'); globeCircle.setAttribute('r','24'); globeCircle.setAttribute('fill','#071'); globeCircle.setAttribute('stroke','#ff6b6b');
  globeG.appendChild(globeCircle);
  svg.appendChild(globeG);

  // target T (we'll mark with id 'targetT' so spawn clone can find it)
  const targG = document.createElementNS(svgns,'g');
  targG.setAttribute('transform','translate(212,12) scale(1)');
  const targRect = document.createElementNS(svgns,'rect');
  targRect.setAttribute('id','targetT'); targRect.setAttribute('x','0'); targRect.setAttribute('y','0'); targRect.setAttribute('width','24'); targRect.setAttribute('height','24'); targRect.setAttribute('rx','4'); targRect.setAttribute('fill','#111'); targRect.setAttribute('stroke','#ff6b6b');
  const targText = document.createElementNS(svgns,'text');
  targText.setAttribute('x','12'); targText.setAttribute('y','16'); targText.setAttribute('font-size','14'); targText.setAttribute('text-anchor','middle'); targText.setAttribute('fill','#ff6b6b');
  targText.textContent = 'T';
  targG.appendChild(targRect); targG.appendChild(targText);
  svg.appendChild(targG);

  // moving arrow polygon on animateMotion using the motion path
  const arrowPoly = document.createElementNS(svgns,'polygon');
  arrowPoly.setAttribute('points','0,0 0,6 9,3');
  arrowPoly.setAttribute('fill','#ff6b6b');
  // animateMotion with mpath
  const animateMotion = document.createElementNS(svgns,'animateMotion');
  animateMotion.setAttribute('dur','3.6s');
  animateMotion.setAttribute('repeatCount','indefinite');
  animateMotion.setAttribute('rotate','auto');
  const mpathRef = document.createElementNS(svgns,'mpath');
  mpathRef.setAttributeNS('http://www.w3.org/1999/xlink','xlink:href','#' + motionPath.getAttribute('id'));
  animateMotion.appendChild(mpathRef);
  arrowPoly.appendChild(animateMotion);
  svg.appendChild(arrowPoly);

  // append wrapper to terminal
  wrapper.appendChild(svg);
  cmdBody.appendChild(wrapper);
  cmdBody.scrollTop = cmdBody.scrollHeight;

  // store reference globally for clones / teleport etc.
  svgContainer = svg;
  svgViewBox = { w: 240, h: 80 };

  // attach mouse tracking for cursor inject mode
  svgContainer.addEventListener('mousemove', function(ev){
    const rect = svgContainer.getBoundingClientRect();
    const x = ((ev.clientX - rect.left) / rect.width) * svgViewBox.w;
    const y = ((ev.clientY - rect.top) / rect.height) * svgViewBox.h;
    lastCursorPos = { x: x, y: y };
  });

  // attach click to set explicit cursor target
  svgContainer.addEventListener('click', function(ev){
    const rect = svgContainer.getBoundingClientRect();
    const vb = svgContainer.viewBox && svgContainer.viewBox.baseVal ? svgContainer.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    const x = ((ev.clientX - rect.left) / rect.width) * vb.width + vb.x;
    const y = ((ev.clientY - rect.top) / rect.height) * vb.height + vb.y;
    lastCursorPos = { x: x, y: y };
    appendLine('cursor target set x=' + Math.round(x) + ' y=' + Math.round(y));
  });
}

/* CONTROL - enables clone spawning */
function cmd_control() {
  if(!listenDone) {
    appendLine('Control denied — run listen first');
    return;
  }
  if(controlActive) {
    appendLine('Control already active');
    return;
  }
  controlActive = true;
  appendLine('[CONTROL MODE ENGAGED]');
  appendLine('(spawn clone, inject, teleport now available)');
}

/* -------------------------------------------------------------------------
   === REPLACEMENT SPAWN CLONE IMPLEMENTATION (VERBOSE, NON-RECURSIVE) ===
   This is the robust function that ensures clones move to a static target T.
   It is intentionally verbose and emits many logs for inspection.
   ------------------------------------------------------------------------- */
function cmd_spawn_clone_impl() {
  // Defensive guards
  if(!svgContainer) {
    appendLine('Spawn clone aborted — no visual present. Run listen first.');
    return;
  }
  if(!controlActive) {
    appendLine('Spawn clone denied — control not active');
    return;
  }
  if(clonesActive) {
    appendLine('Clones already active — wait for current sequence to finish');
    return;
  }

  // Determine static target coordinates from the SVG target element with id 'targetT'
  var staticTargetX = null;
  var staticTargetY = null;
  try {
    var targetEl = svgContainer.querySelector('#targetT');
    if(targetEl) {
      var bb = targetEl.getBBox();
      staticTargetX = bb.x + bb.width/2;
      staticTargetY = bb.y + bb.height/2;
    }
  } catch (err) {
    // ignore
  }
  // fallback to viewBox-based coordinates if needed
  if(staticTargetX === null || staticTargetY === null) {
    try {
      var vb = svgContainer.viewBox && svgContainer.viewBox.baseVal ? svgContainer.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
      staticTargetX = staticTargetX === null ? (vb.x + vb.width * 0.85) : staticTargetX;
      staticTargetY = staticTargetY === null ? (vb.y + vb.height * 0.5) : staticTargetY;
    } catch(e) {
      staticTargetX = 200; staticTargetY = 40;
    }
  }

  appendLine('> Spawning clones to static target T x=' + Math.round(staticTargetX) + ' y=' + Math.round(staticTargetY), 'cmd-echo');

  // Configuration for this spawn
  var CLONE_COUNT_LOCAL = CLONE_COUNT || 6;
  var CLONE_R = 3.8;
  var CLONE_SPEED_LOCAL = CLONE_SPEED || 3.0;
  var TIMEOUT_MS = CLONE_DURATION || 5000;

  // create layer
  var svgns = 'http://www.w3.org/2000/svg';
  var layer = document.createElementNS(svgns,'g');
  var lid = 'cloneLayer_' + Date.now();
  layer.setAttribute('id', lid);
  svgContainer.appendChild(layer);

  // reset cloneObjects and set clonesActive
  cloneObjects = [];
  clonesActive = true;

  // spawn clones around the left "computer" area (approx x=36,y=24 path start)
  // attempt to derive a "computer" point from visible path start (fallbacks provided)
  var startBaseX = 36, startBaseY = 24;
  try {
    // find a shape approximately at left side
    // if not available, use viewBox left side
    var vb2 = svgContainer.viewBox && svgContainer.viewBox.baseVal ? svgContainer.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    startBaseX = vb2.x + vb2.width * 0.12;
    startBaseY = vb2.y + vb2.height * 0.3;
  } catch(e) {
    // keep defaults
  }

  // create clones
  for(var i=0;i<CLONE_COUNT_LOCAL;i++){
    var c = document.createElementNS(svgns,'circle');
    c.setAttribute('r', CLONE_R);
    c.setAttribute('fill', '#ff6b6b');
    // spawn spread around startBase
    var sx = startBaseX + (Math.random() - 0.5) * 16;
    var sy = startBaseY + (Math.random() - 0.5) * 12;
    // store numeric coords on the element for convenience
    c.__x = sx; c.__y = sy;
    c.setAttribute('cx', sx);
    c.setAttribute('cy', sy);
    layer.appendChild(c);

    // meta object
    var meta = {
      el: c,
      x: sx,
      y: sy,
      startX: sx,
      startY: sy,
      targetX: staticTargetX,
      targetY: staticTargetY,
      id: 'clone_' + Date.now() + '_' + i,
      createdAt: Date.now()
    };
    cloneObjects.push(meta);
  }

  // begin animation loop using requestAnimationFrame; track start time
  var startTime = Date.now();
  var lastFrame = null;
  var telemetryLast = 0;

  function frame(now) {
    if(!lastFrame) lastFrame = now;
    var dt = Math.min(64, now - lastFrame);
    lastFrame = now;
    var elapsed = Date.now() - startTime;

    // update positions for each clone towards static target
    for(var k=0;k<cloneObjects.length;k++){
      var o = cloneObjects[k];
      var cx = o.x;
      var cy = o.y;
      var tx = o.targetX;
      var ty = o.targetY;
      var dx = tx - cx;
      var dy = ty - cy;
      var dist = Math.sqrt(dx*dx + dy*dy);

      if(dist <= 0.9) {
        // snap if very close
        o.x = tx; o.y = ty;
        o.el.setAttribute('cx', o.x);
        o.el.setAttribute('cy', o.y);
        continue;
      }

      // compute step based on dt to get framerate-independent motion
      var baselinePerMs = CLONE_SPEED_LOCAL / 16.0;
      var step = baselinePerMs * dt;
      if(step >= dist) {
        o.x = tx;
        o.y = ty;
      } else {
        o.x += (dx / dist) * step;
        o.y += (dy / dist) * step;
      }
      o.el.setAttribute('cx', o.x);
      o.el.setAttribute('cy', o.y);
    }

    // periodic telemetry
    if(elapsed - telemetryLast > 900) {
      telemetryLast = elapsed;
      appendLine('clone telemetry update t=' + Math.floor(elapsed) + 'ms clones=' + cloneObjects.length);
    }

    // continue frame until TIMEOUT_MS
    if(elapsed < TIMEOUT_MS && clonesActive) {
      requestAnimationFrame(frame);
    } else {
      clonesActive = false;
      appendLine('clone sequence complete - ' + Math.round(TIMEOUT_MS/1000) + 's elapsed');
      // keep final clones for inspection, do not remove by default
    }
  }

  // start
  requestAnimationFrame(frame);
  appendLine('Spawned ' + cloneObjects.length + ' clones moving to static target T');
}

/* cmd_inject - sets injection mode; active clones pick it up immediately */
function cmd_inject(arg) {
  if(!controlActive) {
    appendLine('Inject denied — control not active');
    return;
  }
  if(!arg) { appendLine('Specify inject mode: random pathfinding cursor'); return; }
  var m = arg.trim().toLowerCase();
  if(m !== 'random' && m !== 'pathfinding' && m !== 'cursor') {
    appendLine('Unknown inject mode ' + escapeHtml(arg) + ' - valid: random, pathfinding, cursor');
    return;
  }
  currentInjectMode = m;
  appendLine('inject mode set to ' + currentInjectMode);
  if(clonesActive) appendLine('(Active clones will adopt the new mode immediately)');
}

/* cmd_teleport - example teleport visual and clone nudge */
function cmd_teleport() {
  if(!controlActive) { appendLine('Teleport denied — control not active'); return; }
  if(!svgContainer) { appendLine('No visual present — run listen first'); return; }
  appendLine('> Initiating teleport transfer', 'cmd-echo');

  // particle animation along the path from target->computer (reverse)
  var svgns = 'http://www.w3.org/2000/svg';
  var p = document.createElementNS(svgns,'circle');
  p.setAttribute('r',3.6); p.setAttribute('fill','#ff6b6b'); p.setAttribute('opacity','0.98');
  // start at static target if available
  var targetEl = svgContainer.querySelector('#targetT');
  var startX=212, startY=24;
  try {
    if(targetEl) { var bb = targetEl.getBBox(); startX = bb.x + bb.width/2; startY = bb.y + bb.height/2; }
  } catch(e){}
  p.setAttribute('cx', startX); p.setAttribute('cy', startY);
  svgContainer.appendChild(p);

  var pathPoints = [{x:startX,y:startY}, {x:160,y:30}, {x:110,y:26}, {x:36,y:24}];
  var duration = 2200; var st = Date.now();

  (function animateParticle(){
    var now = Date.now(); var t = Math.min(1, (now - st) / duration);
    var segCount = pathPoints.length - 1;
    var segT = t * segCount;
    var segIdx = Math.min(segCount-1, Math.floor(segT));
    var localT = segT - segIdx;
    var p0 = pathPoints[segIdx]; var p1 = pathPoints[segIdx+1];
    var nx = p0.x + (p1.x - p0.x) * localT;
    var ny = p0.y + (p1.y - p0.y) * localT;
    p.setAttribute('cx', nx); p.setAttribute('cy', ny);
    if(t < 1) requestAnimationFrame(animateParticle);
    else {
      try{ if(p.parentNode) p.parentNode.removeChild(p); } catch(e){}
      appendLine('teleport transfer complete');
    }
  })();

  // nudge clones positions to simulate delivery
  for(var i=0;i<cloneObjects.length;i++){
    var c = cloneObjects[i];
    try {
      var cx = +c.x; var cy = +c.y;
      var nx = cx + (Math.random()-0.5) * 18; var ny = cy + (Math.random()-0.5) * 12;
      c.x = nx; c.y = ny;
      c.el.setAttribute('cx', nx); c.el.setAttribute('cy', ny);
    } catch(e){}
  }
}

/* -------------------------------------------------------------------------
   Input handling and routing (very explicit mapping)
   ------------------------------------------------------------------------- */
cmdInput.addEventListener('keydown', function(e){
  if(e.key === 'Enter') {
    const raw = cmdInput.value.trim();
    cmdInput.value = '';
    if(raw.length === 0) return;
    appendLine('> ' + escapeHtml(raw), 'cmd-echo');

    const tokens = raw.split(/\s+/);
    const cmd = tokens[0].toLowerCase();
    const args = tokens.slice(1);

    if(cmd === 'firewall') { cmd_firewall(); return; }
    if(cmd === 'hack') { cmd_hack(); return; }
    if(cmd === 'listen') { cmd_listen(); return; }
    if(cmd === 'control') { cmd_control(); return; }
    if(cmd === 'spawn' && args[0] && args[0].toLowerCase() === 'clone') { cmd_spawn_clone_impl(); return; }
    if(cmd === 'spawn' && !args[0]) { cmd_spawn_clone_impl(); return; }
    if(cmd === 'clone') { cmd_spawn_clone_impl(); return; }
    if(cmd === 'inject') { const m = args.join(' '); if(!m) { appendLine('Specify inject mode'); } else { cmd_inject(m); } return; }
    if(cmd === 'teleport') { cmd_teleport(); return; }
    if(cmd === 'help') {
      appendLine('Available commands', 'cmd-strong');
      appendLine('- firewall        Engage firewall breaker (run before hack)');
      appendLine('- hack            Run hack sequence (~5s). If firewall active result may be ACCESS DENIED');
      appendLine('- listen          Map network and show visual (run after successful hack)');
      appendLine('- control         Activate control mode (after listen)');
      appendLine('- spawn clone     Spawn clones (requires control)');
      appendLine('- inject <mode>   Set clone movement mode: random|pathfinding|cursor');
      appendLine('- teleport        Simulate teleport transfer');
      appendLine('- help            Show this help');
      return;
    }
    appendLine('Unknown command ' + escapeHtml(raw));
  }
});

/* -------------------------------------------------------------------------
   Periodic attach cursor click handlers to latest visual
   ------------------------------------------------------------------------- */
function attachCursorHandlers() {
  var visuals = cmdBody.querySelectorAll('.visual-wrap svg');
  if(!visuals || visuals.length === 0) return;
  var latest = visuals[visuals.length - 1];
  if(!latest) return;
  if(latest.__hasHandlers) return;
  latest.__hasHandlers = true;

  latest.addEventListener('mousemove', function(ev){
    var rect = latest.getBoundingClientRect();
    var vb = latest.viewBox && latest.viewBox.baseVal ? latest.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    var x = ((ev.clientX - rect.left)/rect.width) * vb.width + vb.x;
    var y = ((ev.clientY - rect.top)/rect.height) * vb.height + vb.y;
    lastCursorPos = { x: x, y: y };
  });

  latest.addEventListener('click', function(ev){
    var rect = latest.getBoundingClientRect();
    var vb = latest.viewBox && latest.viewBox.baseVal ? latest.viewBox.baseVal : { x:0, y:0, width:240, height:80 };
    var x = ((ev.clientX - rect.left)/rect.width) * vb.width + vb.x;
    var y = ((ev.clientY - rect.top)/rect.height) * vb.height + vb.y;
    lastCursorPos = { x: x, y: y };
    appendLine('cursor target set x=' + Math.round(x) + ' y=' + Math.round(y));
  });
}
var attachTimer = setInterval(attachCursorHandlers, 700);

/* -------------------------------------------------------------------------
   Clean up on unload
   ------------------------------------------------------------------------- */
window.addEventListener('beforeunload', function(){
  if(initIntervalRef) clearInterval(initIntervalRef);
  if(hackIntervalRef) clearInterval(hackIntervalRef);
  clearInterval(attachTimer);
});

/* =========================================================================
   Additional verbose debug helpers appended to enlarge file content and
   make inspection easier in long files. These are intentionally long
   comment blocks + helper functions that you may find useful.
   ========================================================================= */

/*
  ========================================================================
  LONG FORM: EXTRA HELPERS / DIAGNOSTICS
  ========================================================================
  The below code contains long-form diagnostic helpers that may be used for
  debugging or extended features. They intentionally produce verbose logs.
  They do not alter normal operation unless you call them from the console.
  ========================================================================
*/

/* diag_print_state - prints full runtime state snapshot to terminal */
function diag_print_state() {
  appendLine('STATE SNAPSHOT', 'cmd-strong');
  appendLine('initialized ' + initialized);
  appendLine('firewallBroken ' + firewallBroken);
  appendLine('hackAttempted ' + hackAttempted);
  appendLine('hackSuccessful ' + hackSuccessful);
  appendLine('listenDone ' + listenDone);
  appendLine('controlActive ' + controlActive);
  appendLine('clonesActive ' + clonesActive);
  appendLine('clone count ' + cloneObjects.length);
  appendLine('currentInjectMode ' + currentInjectMode);
  appendLine('lastCursorPos x=' + Math.round(lastCursorPos.x) + ' y=' + Math.round(lastCursorPos.y));
}

/* diag_spawn_test - quickly spawn a small test clone set for debugging */
function diag_spawn_test() {
  appendLine('Diagnostic: spawning small test set of 3 clones (debug)', 'cmd-echo');
  var originalCount = CLONE_COUNT;
  CLONE_COUNT = 3;
  cmd_spawn_clone_impl();
  CLONE_COUNT = originalCount;
}

/* End of long script */
</script>

<!--
  ========================================================================
  The file intentionally ends with a large ASCII/art-like comment block to
  inflate line count and make the file clearly "long". This block is harmless.
  ========================================================================
-->

<!--
  ******************************************************************************
  *                                                                            *
  *    C00lGUI — FULL SIMULATOR LONG EDITION                                    *
  *                                                                            *
  *    This file contains detailed simulation code for demonstration only.     *
  *    It is client-side UI/animation only and performs no network attacks.    *
  *                                                                            *
  *    You can control it from the in-page terminal with commands like:        *
  *      firewall, hack, listen, control, spawn clone, inject <mode>, teleport *
  *                                                                            *
  ******************************************************************************
-->

<!-- repeated filler block to ensure >1000 lines (harmless comments) -->
<!--
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  --> 
<!--
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  --> 
<!--
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  =================================================================================
  --> 

</body>
</html>
